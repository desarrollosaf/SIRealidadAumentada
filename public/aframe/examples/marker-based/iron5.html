<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Video Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Estilos para pantalla completa -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: black;
        height: 100%;
        width: 100%;
      }

      a-scene {
        position: fixed;
        top: 0;
        left: 0;
        height: 100% !important;
        width: 100% !important;
      }
    </style>

    <!-- Librer√≠as necesarias -->
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>
  </head>

  <body>
    <a-scene
      mindar-image="imageTargetSrc: https://sistemas.siasaf.gob.mx/aframe/examples/assets/targetsc.mind;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
    >

      <!-- Assets de video -->
      <a-assets>
        <video id="video1" src="https://sistemas.siasaf.gob.mx/aframe/examples/assets/centro.mp4"
               preload="auto" playsinline muted crossorigin="anonymous" loop></video>
        <video id="video2" src="https://sistemas.siasaf.gob.mx/aframe/examples/assets/izquierda.mp4"
               preload="auto" playsinline muted crossorigin="anonymous" loop></video>
        <video id="video3" src="https://sistemas.siasaf.gob.mx/aframe/examples/assets/derecha.mp4"
               preload="auto" playsinline muted crossorigin="anonymous" loop></video>
      </a-assets>

      <!-- C√°mara -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Plano de video (fijo frente a la c√°mara) -->
      <a-video id="video-plane"
               position="0 0 -2"
               width="1"
               height="1.7"
               visible="false"
               autoplay
               loop
               muted
               playsinline>
      </a-video>

      <!-- Targets invisibles para detecci√≥n -->
      <a-entity mindar-image-target="targetIndex: 0" id="target0"></a-entity>
      <a-entity mindar-image-target="targetIndex: 1" id="target1"></a-entity>
      <a-entity mindar-image-target="targetIndex: 2" id="target2"></a-entity>

    </a-scene>

    <!-- L√≥gica -->
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const sceneEl = document.querySelector('a-scene');
        const videoPlane = document.querySelector('#video-plane');

        const videos = {
          0: document.querySelector('#video2'), // izquierda
          1: document.querySelector('#video3'), // derecha
          2: document.querySelector('#video1'), // centro
        };

        // Forzar reproducci√≥n tras interacci√≥n
        document.body.addEventListener("click", () => {
          Object.values(videos).forEach(video => {
            video.play().catch(() => {});
          });
        }, { once: true });

        sceneEl.addEventListener("loaded", () => {
          [0, 1, 2].forEach(index => {
            const target = document.querySelector(`#target${index}`);
            target.addEventListener("targetFound", () => {
              const vid = videos[index];

              // Detener todos los videos
              Object.values(videos).forEach(v => {
                v.pause();
                v.currentTime = 0;
              });

              // Mostrar y reproducir el correspondiente
              videoPlane.setAttribute("src", `#${vid.id}`);
              vid.play().catch(() => {});
              videoPlane.setAttribute("visible", true);

              console.log("üìå Target", index, "detectado. Mostrando video:", vid.id);
            });

            target.addEventListener("targetLost", () => {
              const vid = videos[index];
              vid.pause();
              videoPlane.setAttribute("visible", false);

              console.log("‚ùå Target", index, "perdido.");
            });
          });
        });
      });
    </script>
  </body>
</html>
